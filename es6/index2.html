<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>

<body>
    <script>
        // Promise基本用法,Promise对象是一个构造函数,用来生成Promise实例
        // const promise = new Promise(function(resolve,reject){
        //     var num =Math.floor( Math.random()*100)
        //     if(num < 50){
        //         resolve("you are resolve");
        //     }else{
        //         reject("you are a louser");
        //     }
        // })
        //Promise就是一个状态机，他有三种状态分别为pendding resolve reject，但是最终表现出来的
        //结果只是两种状态就是成功与失败，其常用于异步函数的操作
        //then方法，可以接受两个回调函数作为参数，第一个参数为resolve函数调用，第二个为reject函数调用
        //第二个函数是可选的，不一定要提供。这两个函数都接收Promise对象传出的值作为参数
        // promise.then(function(data){console.log(data)},function(error){console.log(error)});

        //此时在timeOut()中使用Promise实例，然后使用setTimeout设置指定的时间后再来执行，这样做的原因是
        //Promise新建之后就会马上去执行函数的结果
        // function timeOut(ms){
        //     return new Promise(function(resolve,reject){
        //         setTimeout(resolve,ms,'done');
        //     });
        // }
        // timeOut(100).then((value)=>{
        //     console.log(value);
        // })

        //下面这段代码中，首先Promise新建之后就会立即执行，所以首先输出的是Promise。然后，then指定的方法会在
        //当前脚本所有同步方法执行完之后才会执行所以.resolve最后执行输出
        // let promise = new Promise(function(resolve,reject){
        //     console.log('Promise');
        //     resolve();
        // })
        // promise.then(function(){
        //     console.log('.resolve');
        // })
        // console.log('ms');

        //图片的异步加载方法，通过Promise实例调用两个回调函数，如果加载成功就调用resolve方法，如果加载失败就
        //调用reject方法
        // function loadImg(url) {
        //     return new Promise(function (resolve, reject) {
        //         const image = new Image();

        //         image.onload = function () {
        //             resolve(image);
        //         };

        //         image.onerror = function () {
        //             reject(new Error(`Could not load image at ${url}`));
        //         };

        //         image.src = url;
        //     });
        // }

        //Ajax请求使用Promise实例封装
        const JsonLoad = function(url){
            const promise =  new Promise(function(resolve,reject){
                const handler = function(){
                    if(this.readyState !== 4){
                        return;
                    }
                    if(this.readyState === 200){
                        resolve(this.response);
                    }else{
                        reject(new Erroe(this.statusText));
                    }
                };
                const client = new XMLHttpRequest();
                client.open("GET",url);
                client.onreadyStatechange = handler;
                client.responseType = "json";
                client.setRequestHeader("Accept","application/json");
                client.send();
            })
            return promise;
        }
    
        JsonLoad("/post.json").then(function(json){
            console.log('Contents: ' + json);
        },function(error){
            console.error('error',error);
        })

    </script>
</body>

</html>